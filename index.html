<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SwiftCoin Pro</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root { 
            --bg: #f4f7f6; --text: #2d3436; --card: #ffffff; 
            --accent: #00b894; --danger: #ff7675; --overlay: rgba(255,255,255,0.8);
        }
        body.dark-theme { 
            --bg: #1e272e; --text: #f1f2f6; --card: #2f3542; --overlay: rgba(47, 53, 66, 0.9);
        }
        
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; transition: 0.2s; }
        body { margin: 0; height: 100vh; color: var(--text); background: var(--bg); background-size: cover; background-position: center; background-attachment: fixed; overflow: hidden; }

        /* SCREEN MANAGEMENT */
        .page { display: none; height: 100vh; flex-direction: column; position: absolute; width: 100%; top: 0; left: 0; }
        .page.active { display: flex; }
        .content-area { flex: 1; overflow-y: auto; padding: 15px; background: var(--overlay); }

        /* HEADER */
        .nav-header { padding: 15px 20px; background: var(--card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.1); z-index: 10; }
        .title { font-weight: 800; font-size: 20px; }

        /* STATS & PROGRESS (Restored) */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; text-align: center; }
        .stat-box { background: var(--card); padding: 12px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat-label { font-size: 10px; font-weight: 800; opacity: 0.6; text-transform: uppercase; }
        .stat-val { font-size: 15px; font-weight: 900; margin-top: 4px; }
        
        .progress-container { background: rgba(0,0,0,0.1); height: 8px; border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        #progressBar { height: 100%; background: var(--accent); width: 0%; transition: 0.5s width ease; }

        /* SETTINGS ITEMS */
        .settings-group { background: var(--card); border-radius: 15px; margin-bottom: 20px; overflow: hidden; }
        .settings-item { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .section-label { font-size: 12px; font-weight: 700; color: var(--accent); margin: 10px 0 5px 10px; text-transform: uppercase; }

        /* BUTTONS */
        .btn { padding: 8px 15px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
        .add-fab { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; border-radius: 20px; background: var(--accent); color: white; border: none; font-size: 30px; box-shadow: 0 8px 15px rgba(0,184,148,0.3); z-index: 100; }

        .expense-card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body class="light-theme">

    <div id="mainPage" class="page active">
        <div class="nav-header">
            <span class="title">SwiftCoin</span>
            <span style="cursor:pointer; font-weight: 600;" onclick="showPage('settingsPage')">‚öôÔ∏è Settings</span>
        </div>
        
        <div class="content-area">
            <div class="stats-grid">
                <div class="stat-box" onclick="editBudget()">
                    <div class="stat-label">Budget ‚úèÔ∏è</div>
                    <div id="statBudget" class="stat-val" style="color:var(--accent)">‚Çπ0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Spent</div>
                    <div id="statSpent" class="stat-val" style="color:var(--danger)">‚Çπ0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Saved</div>
                    <div id="statSaving" class="stat-val">‚Çπ0</div>
                </div>
            </div>

            <div class="progress-container"><div id="progressBar"></div></div>

            <div id="history"></div>
        </div>
        <button class="add-fab" onclick="addExpense()">+</button>
    </div>

    <div id="settingsPage" class="page">
        <div class="nav-header">
            <span style="cursor:pointer; font-weight: 600;" onclick="showPage('mainPage')">‚¨ÖÔ∏è Back</span>
            <span class="title">Settings</span>
            <span></span>
        </div>
        
        <div class="content-area">
            <div class="section-label">Appearance</div>
            <div class="settings-group">
                <div class="settings-item">
                    <span>Theme</span>
                    <div>
                        <button class="btn btn-outline" onclick="setTheme('light-theme')">‚òÄÔ∏è</button>
                        <button class="btn btn-outline" onclick="setTheme('dark-theme')">üåô</button>
                    </div>
                </div>
                <div class="settings-item">
                    <span>Custom BG</span>
                    <button class="btn btn-outline" onclick="document.getElementById('bgUpload').click()">üñºÔ∏è Upload</button>
                    <input type="file" id="bgUpload" accept="image/*" style="display:none" onchange="uploadBG(event)">
                </div>
            </div>

            <div class="section-label">Exports</div>
            <div class="settings-group">
                <div class="settings-item">
                    <span>Download Report</span>
                    <div>
                        <button class="btn btn-outline" onclick="exportPDF()">PDF</button>
                        <button class="btn btn-outline" onclick="exportExcel()">Excel</button>
                    </div>
                </div>
            </div>

            <div class="section-label">Danger Zone</div>
            <div class="settings-group">
                <div class="settings-item" onclick="cleanData('today')"><span>Clear Today</span><span style="color:var(--danger)">üóëÔ∏è</span></div>
                <div class="settings-item" onclick="cleanData('week')"><span>Clear 7 Days</span><span style="color:var(--danger)">üóëÔ∏è</span></div>
                <div class="settings-item" onclick="cleanData('month')"><span>Clear 30 Days</span><span style="color:var(--danger)">üóëÔ∏è</span></div>
                <div class="settings-item" onclick="cleanData('all')"><span style="color:var(--danger); font-weight:bold">CLEAR ALL</span><span>üß®</span></div>
            </div>
        </div>
    </div>

    <script>
        let allData = JSON.parse(localStorage.getItem('swiftCoinPro')) || {};
        let selectedDate = new Date().toISOString().split('T')[0];

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function updateUI() {
            const dayData = allData[selectedDate] || { budget: 0, items: [] };
            const h = document.getElementById('history');
            h.innerHTML = "";
            
            let totalSpent = 0;
            dayData.items.forEach((i, idx) => {
                totalSpent += parseFloat(i.amt);
                h.innerHTML += `<div class="expense-card">
                    <span><b>${i.where}</b><br><small>${selectedDate}</small></span>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <span style="color:var(--danger); font-weight:700;">‚Çπ${i.amt}</span>
                        <span onclick="deleteItem(${idx})" style="opacity:0.3; cursor:pointer;">‚úï</span>
                    </div>
                </div>`;
            });

            // Update Stats
            const budget = dayData.budget || 0;
            const saved = budget - totalSpent;
            document.getElementById('statBudget').innerText = '‚Çπ' + budget;
            document.getElementById('statSpent').innerText = '‚Çπ' + totalSpent;
            document.getElementById('statSaving').innerText = '‚Çπ' + saved;

            // Progress Bar
            const perc = budget > 0 ? Math.min((totalSpent / budget) * 100, 100) : 0;
            const pb = document.getElementById('progressBar');
            pb.style.width = perc + '%';
            pb.style.background = perc > 90 ? 'var(--danger)' : 'var(--accent)';

            localStorage.setItem('swiftCoinPro', JSON.stringify(allData));
        }

        function addExpense() {
            const w = prompt("What for?");
            const a = prompt("Amount?");
            if(w && a) {
                if(!allData[selectedDate]) allData[selectedDate] = { budget: 0, items: [] };
                allData[selectedDate].items.unshift({ where: w, amt: parseFloat(a) });
                updateUI();
            }
        }

        function editBudget() {
            const b = prompt("Daily Budget?", allData[selectedDate]?.budget || 0);
            if(b !== null) {
                if(!allData[selectedDate]) allData[selectedDate] = { budget: 0, items: [] };
                allData[selectedDate].budget = parseFloat(b);
                updateUI();
            }
        }

        function deleteItem(idx) {
            allData[selectedDate].items.splice(idx, 1);
            updateUI();
        }

        // Appearance & Data (Settings Logic)
        function setTheme(t) { document.body.className = t; localStorage.setItem('scTheme', t); }
        
        function uploadBG(e) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                document.body.style.backgroundImage = `url(${ev.target.result})`;
                localStorage.setItem('scCustomBG', ev.target.result);
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function cleanData(type) {
            if(!confirm("Are you sure?")) return;
            const now = new Date();
            if(type === 'all') allData = {};
            else {
                let days = type === 'today' ? 0 : (type === 'week' ? 7 : 30);
                const cutoff = new Date(); cutoff.setDate(now.getDate() - days);
                Object.keys(allData).forEach(date => { if(new Date(date) >= cutoff) delete allData[date]; });
            }
            updateUI();
        }

        function exportExcel() {
            let csv = "Date,Item,Amount\n";
            Object.keys(allData).forEach(d => allData[d].items.forEach(i => csv += `${d},${i.where},${i.amt}\n`));
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'SwiftCoin.csv'; a.click();
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Expense Report", 14, 15);
            let rows = [];
            Object.keys(allData).forEach(d => allData[d].items.forEach(i => rows.push([d, i.where, i.amt])));
            doc.autoTable({ head:[['Date','Item','Amount']], body: rows, startY: 20 });
            doc.save('SwiftCoin.pdf');
        }

        window.onload = () => {
            const bg = localStorage.getItem('scCustomBG');
            if(bg) document.body.style.backgroundImage = `url(${bg})`;
            setTheme(localStorage.getItem('scTheme') || 'light-theme');
            updateUI();
        }
    </script>
</body>
</html>
